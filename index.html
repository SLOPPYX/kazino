<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞–∑–∏–Ω–æ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100%; overflow: hidden; position: fixed; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #000000; color: #ffffff; padding: 15px; -webkit-user-select: none; user-select: none; }
        .container { max-width: 500px; margin: 0 auto; height: 100%; overflow-y: auto; padding-bottom: 20px; }
        .tabs { position: fixed; top: 15px; right: 15px; z-index: 1000; display: flex; gap: 10px; }
        .tab-btn { background: #ffffff; color: #000000; padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; border: none; box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3); }
        .tab-btn.active { background: #4CAF50; color: #ffffff; }
        .screen { display: none; }
        .screen.active { display: block; }
        .balance-card { background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%); padding: 20px; border-radius: 20px; margin-bottom: 15px; margin-top: 50px; border: 2px solid #ffffff; }
        .balance-amount { font-size: 36px; font-weight: 900; color: #ffffff; margin: 8px 0; text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); transition: all 0.6s; }
        .balance-amount.win-animation { animation: balanceWin 0.6s ease; }
        .balance-amount.lose-animation { animation: balanceLose 0.6s ease; }
        @keyframes balanceWin { 0% { transform: scale(1); color: #fff; } 50% { transform: scale(1.15); color: #4CAF50; text-shadow: 0 0 30px #4CAF50; } 100% { transform: scale(1); color: #fff; } }
        @keyframes balanceLose { 0% { transform: scale(1); color: #fff; } 50% { transform: scale(0.9); color: #f44; text-shadow: 0 0 30px #f44; } 100% { transform: scale(1); color: #fff; } }
        .slots-container { background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%); padding: 25px 15px; border-radius: 20px; margin-bottom: 15px; border: 2px solid #333; }
        .slots { display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; }
        .slot { width: 85px; height: 85px; background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 48px; border: 3px solid #fff; }
        .slot.spinning { animation: spin 0.1s linear infinite; }
        @keyframes spin { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(360deg); } }
        .result-line { text-align: center; font-size: 16px; font-weight: 700; margin-bottom: 15px; min-height: 24px; padding: 8px; border-radius: 10px; }
        .result-line.win { color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
        .result-line.lose { color: #f44; background: rgba(255, 68, 68, 0.1); }
        .spin-modes { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .mode-btn { padding: 12px; border-radius: 12px; border: 2px solid #fff; font-size: 14px; font-weight: 700; cursor: pointer; background: #000; color: #fff; }
        .mode-btn.active { background: #fff; color: #000; }
        .spin-btn { width: 100%; padding: 18px; border-radius: 15px; border: none; font-size: 18px; font-weight: 900; cursor: pointer; background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%); color: #000; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; }
        .spin-btn:disabled { background: #333; color: #666; }
        .stop-btn { width: 100%; padding: 18px; border-radius: 15px; border: none; font-size: 18px; font-weight: 900; cursor: pointer; background: linear-gradient(135deg, #f44 0%, #c33 100%); color: #fff; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; display: none; animation: pulse 1s ease-in-out infinite; }
        .stop-btn.show { display: block; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        .bet-input-section { background: #1a1a1a; padding: 18px; border-radius: 15px; margin-bottom: 15px; border: 2px solid #fff; }
        .bet-input { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #fff; background: #000; color: #fff; font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 12px; }
        .bet-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .bet-quick { padding: 12px 8px; border-radius: 10px; border: 2px solid #fff; font-size: 13px; font-weight: 700; cursor: pointer; background: #000; color: #fff; }
        .calculations { background: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 12px; }
        .calc-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; }
        .calc-value.win { color: #4CAF50; font-weight: 700; }
        .calc-value.lose { color: #f44; font-weight: 700; }
        .odds-section { background: #1a1a1a; padding: 18px; border-radius: 15px; margin-bottom: 15px; border: 2px solid #f80; }
        .odds-title { font-size: 16px; font-weight: 700; margin-bottom: 15px; text-align: center; color: #f80; }
        .odds-control { margin-bottom: 12px; }
        .odds-label { font-size: 13px; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .odds-slider { width: 100%; height: 6px; border-radius: 5px; background: #333; outline: none; }
        .odds-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #fff; cursor: pointer; }
        .payouts { background: #1a1a1a; padding: 18px; border-radius: 15px; border: 2px solid #333; margin-bottom: 20px; }
        .payout-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333; font-size: 15px; }
        .payout-row:last-child { border-bottom: none; }
        .profile-screen { margin-top: 50px; }
        .profile-header { background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%); padding: 30px 20px; border-radius: 20px; margin-bottom: 20px; text-align: center; }
        .profile-title { font-size: 24px; font-weight: 900; margin-bottom: 10px; }
        .stat-card { background: #1a1a1a; padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 2px solid #333; }
        .stat-card-title { font-size: 16px; font-weight: 700; margin-bottom: 15px; text-align: center; color: #4CAF50; }
        .stat-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #333; font-size: 15px; }
        .stat-row:last-child { border-bottom: none; }
        .stat-value { font-weight: 700; color: #4CAF50; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal.show { display: flex; }
        .modal-content { background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%); padding: 40px 30px; border-radius: 20px; border: 3px solid #f44; text-align: center; max-width: 320px; }
        .modal-title { font-size: 28px; font-weight: 900; color: #f44; margin-bottom: 20px; }
        .modal-text { font-size: 16px; margin-bottom: 25px; line-height: 1.5; }
        .modal-btn { padding: 14px 40px; border-radius: 12px; border: none; background: #fff; color: #000; font-size: 16px; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>
    <div class="tabs">
        <button class="tab-btn active" onclick="showScreen('game')">üé∞ –ò–≥—Ä–∞</button>
        <button class="tab-btn" onclick="showScreen('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        <button class="tab-btn" onclick="exitAndSave()">üè† –í—ã—Ö–æ–¥</button>
    </div>
    <div class="container">
        <div class="screen active" id="gameScreen">
            <div class="balance-card">
                <div style="font-size: 11px; opacity: 0.7; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 5px;">üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="balance">0 üíé</div>
            </div>
            <div class="slots-container">
                <div class="slots">
                    <div class="slot" id="slot1">üé∞</div>
                    <div class="slot" id="slot2">üé∞</div>
                    <div class="slot" id="slot3">üé∞</div>
                </div>
                <div class="result-line" id="resultLine"></div>
                <div class="spin-modes">
                    <button class="mode-btn active" id="normalMode" onclick="setMode('normal')">üé∞ –û–±—ã—á–Ω—ã–π</button>
                    <button class="mode-btn" id="fastMode" onclick="setMode('fast')">‚ö° –ë—ã—Å—Ç—Ä—ã–π</button>
                </div>
                <button class="spin-btn" id="spinBtn" onclick="handleSpin()">üé∞ –ö–†–£–¢–ò–¢–¨</button>
                <button class="stop-btn" id="stopBtn" onclick="stopAutoSpin()">üõë –û–°–¢–ê–ù–û–í–ò–¢–¨ –ê–í–¢–û-–°–ü–ò–ù</button>
                <div style="text-align: center; margin-top: 10px;">
                    <label style="font-size: 14px;">
                        <input type="checkbox" id="autoSpinCheck" style="margin-right: 5px;">
                        üîÑ –ê–≤—Ç–æ-—Å–ø–∏–Ω (<span id="autoCount">0</span>/10)
                    </label>
                </div>
            </div>
            <div class="bet-input-section">
                <div style="font-size: 13px; margin-bottom: 10px; font-weight: 600;">üíµ –£–∫–∞–∂–∏—Ç–µ –¢–û–ß–ù–£–Æ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏:</div>
                <input type="number" class="bet-input" id="betInput" placeholder="–õ—é–±–∞—è —Å—É–º–º–∞ –æ—Ç 10,000" min="10000" step="1" oninput="updateCalculations()">
                <div class="bet-buttons">
                    <button class="bet-quick" onclick="setQuickBet(10000)">10K</button>
                    <button class="bet-quick" onclick="setQuickBet(50000)">50K</button>
                    <button class="bet-quick" onclick="setQuickBet(100000)">100K</button>
                    <button class="bet-quick" onclick="setQuickBet(500000)">500K</button>
                </div>
                <div class="calculations">
                    <div class="calc-row"><span>üíé –ú–∞–∫—Å –≤—ã–∏–≥—Ä—ã—à (x100):</span><span class="calc-value win" id="maxWinCalc">+0</span></div>
                    <div class="calc-row"><span>üìâ –ü—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ:</span><span class="calc-value lose" id="maxLose">-0</span></div>
                </div>
            </div>
            <div class="odds-section" id="oddsSection" style="display: none;">
                <div class="odds-title">üîß –ê–î–ú–ò–ù: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–Ω—Å–æ–≤ –î–õ–Ø –í–°–ï–•</div>
                <div class="odds-control"><div class="odds-label"><span>üíé –ê–ª–º–∞–∑—ã (x100)</span><span id="c0">10%</span></div><input type="range" class="odds-slider" id="s0" min="1" max="50" value="10" oninput="updateOdds()"></div>
                <div class="odds-control"><div class="odds-label"><span>üçí –í–∏—à–Ω–∏ (x50)</span><span id="c1">15%</span></div><input type="range" class="odds-slider" id="s1" min="1" max="50" value="15" oninput="updateOdds()"></div>
                <div class="odds-control"><div class="odds-label"><span>üçã –õ–∏–º–æ–Ω—ã (x30)</span><span id="c2">15%</span></div><input type="range" class="odds-slider" id="s2" min="1" max="50" value="15" oninput="updateOdds()"></div>
                <div class="odds-control"><div class="odds-label"><span>üçä –ê–ø–µ–ª—å—Å–∏–Ω—ã (x20)</span><span id="c3">15%</span></div><input type="range" class="odds-slider" id="s3" min="1" max="50" value="15" oninput="updateOdds()"></div>
                <div class="odds-control"><div class="odds-label"><span>üçá –í–∏–Ω–æ–≥—Ä–∞–¥ (x15)</span><span id="c4">15%</span></div><input type="range" class="odds-slider" id="s4" min="1" max="50" value="15" oninput="updateOdds()"></div>
                <div class="odds-control"><div class="odds-label"><span>‚≠ê –ó–≤—ë–∑–¥—ã (x10)</span><span id="c5">10%</span></div><input type="range" class="odds-slider" id="s5" min="1" max="50" value="10" oninput="updateOdds()"></div>
                <div class="odds-control"><div class="odds-label"><span>üîî –ö–æ–ª–æ–∫–æ–ª–∞ (x5)</span><span id="c6">10%</span></div><input type="range" class="odds-slider" id="s6" min="1" max="50" value="10" oninput="updateOdds()"></div>
                <div class="odds-control"><div class="odds-label"><span>7Ô∏è‚É£ –°–µ–º—ë—Ä–∫–∏ (x3)</span><span id="c7">10%</span></div><input type="range" class="odds-slider" id="s7" min="1" max="50" value="10" oninput="updateOdds()"></div>
            </div>
            <div class="payouts">
                <div style="font-size: 16px; font-weight: 700; margin-bottom: 12px; text-align: center;">üéØ –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç</div>
                <div class="payout-row"><span>üíéüíéüíé</span><span>x100 üî•</span></div>
                <div class="payout-row"><span>üçíüçíüçí</span><span>x50</span></div>
                <div class="payout-row"><span>üçãüçãüçã</span><span>x30</span></div>
                <div class="payout-row"><span>üçäüçäüçä</span><span>x20</span></div>
                <div class="payout-row"><span>üçáüçáüçá</span><span>x15</span></div>
                <div class="payout-row"><span>‚≠ê‚≠ê‚≠ê</span><span>x10</span></div>
                <div class="payout-row"><span>üîîüîîüîî</span><span>x5</span></div>
                <div class="payout-row"><span>7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£</span><span>x3</span></div>
            </div>
        </div>
        <div class="screen" id="profileScreen">
            <div class="profile-screen">
                <div class="profile-header">
                    <div class="profile-title">üë§ –ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</div>
                    <div style="font-size: 14px; opacity: 0.9;" id="profileId">ID: Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">üìä –í–µ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    <div class="stat-row"><span style="opacity: 0.8;">üé∞ –í—Å–µ–≥–æ —Å–ø–∏–Ω–æ–≤:</span><span class="stat-value" id="totalSpins">0</span></div>
                    <div class="stat-row"><span style="opacity: 0.8;">üíé –ú–∞–∫—Å –≤—ã–∏–≥—Ä—ã—à:</span><span class="stat-value" id="maxWin">0 üíé</span></div>
                    <div class="stat-row"><span style="opacity: 0.8;">üèÜ –í—Å–µ–≥–æ –≤—ã–∏–≥—Ä–∞–Ω–æ:</span><span class="stat-value" id="totalWon">0 üíé</span></div>
                    <div class="stat-row"><span style="opacity: 0.8;">üìâ –í—Å–µ–≥–æ –ø—Ä–æ–∏–≥—Ä–∞–Ω–æ:</span><span class="stat-value" id="totalLost">0 üíé</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">üí∞ –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è</div>
                    <div class="stat-row"><span style="opacity: 0.8;">–ù–∞—á–∞–ª—å–Ω—ã–π:</span><span class="stat-value" id="initialBalance">0 üíé</span></div>
                    <div class="stat-row"><span style="opacity: 0.8;">–¢–µ–∫—É—â–∏–π:</span><span class="stat-value" id="currentBalance">0 üíé</span></div>
                    <div class="stat-row"><span style="opacity: 0.8;">–ò–∑–º–µ–Ω–µ–Ω–∏–µ:</span><span class="stat-value" id="balanceChange">0 üíé</span></div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-title">‚ùå –û—à–∏–±–∫–∞</div>
            <div class="modal-text" id="errorText">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤!</div>
            <button class="modal-btn" onclick="closeModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>
    <script>
        let tg=window.Telegram.WebApp;tg.ready();tg.expand();tg.disableVerticalSwipes();tg.MainButton.hide();
        const ADMIN_ID=2026521416;
        let BALANCE=0,INITIAL_BALANCE=0,BET=10000,USER_ID=0,CUSTOM_ID='',isSpinning=false,spinMode='normal',autoSpinCount=0,isAdmin=false,stopAutoSpinFlag=false;
        let stats={totalSpins:0,maxWin:0,totalWon:0,totalLost:0};
        let odds=[10,15,15,15,15,10,10,10];
        const SYMBOLS=['üíé','üçí','üçã','üçä','üçá','‚≠ê','üîî','7Ô∏è‚É£'];
        const PAYOUTS={'üíé':100,'üçí':50,'üçã':30,'üçä':20,'üçá':15,'‚≠ê':10,'üîî':5,'7Ô∏è‚É£':3};
        
        function getParams(){
            const url=new URLSearchParams(window.location.search);
            USER_ID=parseInt(url.get('user_id'))||0;
            CUSTOM_ID=url.get('custom_id')||'';
            BALANCE=parseInt(url.get('tokens'))||0;
            INITIAL_BALANCE=BALANCE;
            isAdmin=(USER_ID===ADMIN_ID);
            if(isAdmin){document.getElementById('oddsSection').style.display='block';console.log('üîß –ê–î–ú–ò–ù —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');}
            loadStats();loadOdds();updateBalance();updateProfileStats();
            document.getElementById('betInput').value=BET;updateCalculations();
        }
        
        function showScreen(s){
            document.querySelectorAll('.screen').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));
            if(s==='game'){
                document.getElementById('gameScreen').classList.add('active');
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
            }else if(s==='profile'){
                document.getElementById('profileScreen').classList.add('active');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                updateProfileStats();
            }
        }
        
        function loadStats(){
            const saved=localStorage.getItem('casino_forever_'+USER_ID);
            if(saved)stats=JSON.parse(saved);
        }
        
        function saveStats(){
            localStorage.setItem('casino_forever_'+USER_ID,JSON.stringify(stats));
        }
        
        function loadOdds(){
            const saved=localStorage.getItem('casino_odds_all');
            if(saved){
                odds=JSON.parse(saved);
                if(isAdmin){
                    for(let i=0;i<8;i++){
                        document.getElementById('s'+i).value=odds[i];
                        document.getElementById('c'+i).textContent=odds[i]+'%';
                    }
                }
            }
        }
        
        function updateOdds(){
            if(!isAdmin){showError('‚õî –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —à–∞–Ω—Å—ã!');return;}
            for(let i=0;i<8;i++){
                odds[i]=parseInt(document.getElementById('s'+i).value);
                document.getElementById('c'+i).textContent=odds[i]+'%';
            }
            localStorage.setItem('casino_odds_all',JSON.stringify(odds));
            console.log('üîß –ê–î–ú–ò–ù —É—Å—Ç–∞–Ω–æ–≤–∏–ª —à–∞–Ω—Å—ã –î–õ–Ø –í–°–ï–•:',odds);
        }
        
        function getWeightedSymbol(){
            const total=odds.reduce((a,b)=>a+b,0);
            let rand=Math.random()*total;
            for(let i=0;i<SYMBOLS.length;i++){
                if(rand<odds[i])return SYMBOLS[i];
                rand-=odds[i];
            }
            return SYMBOLS[SYMBOLS.length-1];
        }
        
        function updateProfileStats(){
            document.getElementById('profileId').textContent='ID: '+CUSTOM_ID;
            document.getElementById('totalSpins').textContent=stats.totalSpins.toLocaleString('ru-RU');
            document.getElementById('maxWin').textContent=stats.maxWin.toLocaleString('ru-RU')+' üíé';
            document.getElementById('totalWon').textContent=stats.totalWon.toLocaleString('ru-RU')+' üíé';
            document.getElementById('totalLost').textContent=stats.totalLost.toLocaleString('ru-RU')+' üíé';
            document.getElementById('initialBalance').textContent=INITIAL_BALANCE.toLocaleString('ru-RU')+' üíé';
            document.getElementById('currentBalance').textContent=BALANCE.toLocaleString('ru-RU')+' üíé';
            const c=BALANCE-INITIAL_BALANCE;
            const el=document.getElementById('balanceChange');
            el.textContent=(c>=0?'+':'')+c.toLocaleString('ru-RU')+' üíé';
            el.style.color=c>=0?'#4CAF50':'#ff4444';
        }
        
        function updateBalance(){document.getElementById('balance').textContent=`${BALANCE.toLocaleString('ru-RU')} üíé`;}
        function animateBalance(w){const e=document.getElementById('balance');e.classList.remove('win-animation','lose-animation');void e.offsetWidth;e.classList.add(w?'win-animation':'lose-animation');}
        function updateCalculations(){const b=getBetAmount();document.getElementById('maxWinCalc').textContent=`+${(b*100).toLocaleString('ru-RU')} üíé`;document.getElementById('maxLose').textContent=`-${b.toLocaleString('ru-RU')} üíé`;}
        function getBetAmount(){let a=parseInt(document.getElementById('betInput').value)||10000;if(a<10000)a=10000;if(a>BALANCE)a=BALANCE;return a;}
        function setQuickBet(a){document.getElementById('betInput').value=a;updateCalculations();if(tg.HapticFeedback)tg.HapticFeedback.impactOccurred('light');}
        function setMode(m){spinMode=m;document.getElementById('normalMode').classList.toggle('active',m==='normal');document.getElementById('fastMode').classList.toggle('active',m==='fast');if(tg.HapticFeedback)tg.HapticFeedback.impactOccurred('light');}
        function showError(t){document.getElementById('errorText').textContent=t;document.getElementById('errorModal').classList.add('show');if(tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('error');}
        function closeModal(){document.getElementById('errorModal').classList.remove('show');}
        
        function stopAutoSpin(){
            stopAutoSpinFlag=true;
            document.getElementById('stopBtn').classList.remove('show');
            document.getElementById('spinBtn').style.display='block';
            console.log('üõë –ê–≤—Ç–æ-—Å–ø–∏–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
            if(tg.HapticFeedback)tg.HapticFeedback.notificationOccurred('warning');
        }
        
        async function handleSpin(){
            const auto=document.getElementById('autoSpinCheck').checked;
            if(auto){
                stopAutoSpinFlag=false;
                document.getElementById('spinBtn').style.display='none';
                document.getElementById('stopBtn').classList.add('show');
                
                for(let i=0;i<10;i++){
                    if(stopAutoSpinFlag){
                        console.log('üõë –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ —Å–ø–∏–Ω–µ',i+1);
                        break;
                    }
                    
                    autoSpinCount=i+1;
                    document.getElementById('autoCount').textContent=autoSpinCount;
                    
                    const ok=await spin();
                    if(!ok){
                        document.getElementById('autoSpinCheck').checked=false;
                        break;
                    }
                    
                    await new Promise(r=>setTimeout(r,spinMode==='fast'?500:1000));
                }
                
                autoSpinCount=0;
                document.getElementById('autoCount').textContent='0';
                document.getElementById('autoSpinCheck').checked=false;
                document.getElementById('stopBtn').classList.remove('show');
                document.getElementById('spinBtn').style.display='block';
            }else await spin();
        }
        
        async function spin(){
            if(isSpinning)return false;
            BET=getBetAmount();
            if(BALANCE<BET){showError(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤!\n\n–ù—É–∂–Ω–æ: ${BET.toLocaleString('ru-RU')} üíé\n–£ –≤–∞—Å: ${BALANCE.toLocaleString('ru-RU')} üíé`);return false;}
            if(BET<10000){showError('‚ùå –ú–∏–Ω–∏–º—É–º 10,000 —Ç–æ–∫–µ–Ω–æ–≤!');return false;}
            isSpinning=true;
            document.getElementById('spinBtn').disabled=true;
            stats.totalSpins++;
            BALANCE-=BET;
            updateBalance();animateBalance(false);
            const slots=[document.getElementById('slot1'),document.getElementById('slot2'),document.getElementById('slot3')];
            slots.forEach(s=>s.classList.add('spinning'));
            if(tg.HapticFeedback)tg.HapticFeedback.impactOccurred('medium');
            await new Promise(r=>setTimeout(r,spinMode==='fast'?800:1500));
            const res=[getWeightedSymbol(),getWeightedSymbol(),getWeightedSymbol()];
            const rt=spinMode==='fast'?100:200;
            for(let i=0;i<3;i++){
                await new Promise(r=>setTimeout(r,rt));
                slots[i].textContent=res[i];
                slots[i].classList.remove('spinning');
                if(tg.HapticFeedback)tg.HapticFeedback.impactOccurred('light');
            }
            let win=0,mult=0;
            if(res[0]===res[1]&&res[1]===res[2]){
                mult=PAYOUTS[res[0]];
                win=BET*mult;
                BALANCE+=win;
                stats.totalWon+=win;
                if(win>stats.maxWin)stats.maxWin=win;
                showResult(`üéâ –í–´–ò–ì–†–´–®! +${win.toLocaleString('ru-RU')} üíé (x${mult})`,true);
                animateBalance(true);
            }else{
                stats.totalLost+=BET;
                showResult(`üíî –ü—Ä–æ–∏–≥—Ä—ã—à -${BET.toLocaleString('ru-RU')} üíé`,false);
            }
            updateBalance();updateCalculations();saveStats();
            await new Promise(r=>setTimeout(r,spinMode==='fast'?300:600));
            document.getElementById('spinBtn').disabled=false;
            isSpinning=false;
            return true;
        }
        
        function showResult(t,w){const l=document.getElementById('resultLine');l.textContent=t;l.className='result-line '+(w?'win':'lose');}
        
        function exitAndSave(){
            console.log('üè† –í—ã—Ö–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª—è—é –±–æ—Ç—É...');
            try{
                const data={action:'casino_save',user_id:USER_ID,custom_id:CUSTOM_ID,balance:BALANCE,initial:INITIAL_BALANCE,stats:stats,timestamp:Date.now()};
                tg.sendData(JSON.stringify(data));
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É:',data);
            }catch(e){
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:',e);
            }
        }
        
        window.addEventListener('beforeunload',()=>{
            try{
                const data={action:'casino_save',user_id:USER_ID,custom_id:CUSTOM_ID,balance:BALANCE,initial:INITIAL_BALANCE,stats:stats,timestamp:Date.now()};
                localStorage.setItem('casino_backup_'+USER_ID,JSON.stringify(data));
            }catch(e){}
        });
        
        getParams();
        console.log('üé∞ –°—Ç–∞—Ä—Ç. User:',USER_ID,'–ê–¥–º–∏–Ω:',isAdmin,'–ë–∞–ª–∞–Ω—Å:',BALANCE);
    </script>
</body>
</html>
